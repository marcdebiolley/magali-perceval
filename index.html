<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mariage de Magali & Perceval</title>
    <link rel="icon" href="./images/branche%20olive.png" type="image/png" />
    <link rel="apple-touch-icon" href="./images/branche%20olive.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="./design.css?v=20260222-5" />
  </head>
  <body>
    <script src="./access.js"></script>

    <nav class="nav" id="main-nav" data-audience="member">
      <div class="nav-inner">
        <a href="#top" class="nav-brand">Magali <span class="amp">&</span> Perceval</a>
        <ul class="nav-links">
          <li><a href="#festivites">Les festivités</a></li>
          <li><a href="#transport">Transport & logement</a></li>
          <li><a href="#region">Région</a></li>
          <li><a href="#contact">Contact</a></li>
          <li><a href="#rsvp">RSVP</a></li>
        </ul>
      </div>
    </nav>

    <div class="pill" id="mobile-pill" data-audience="member">
      <a href="#festivites" class="pill-item active">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
        <span class="pill-label">Fête</span>
      </a>
      <div class="pill-sep"></div>
      <a href="#transport" class="pill-item">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M3 13l1-4a3 3 0 0 1 3-2h10a3 3 0 0 1 3 2l1 4"/><path d="M5 13h14"/><path d="M6 17h1"/><path d="M17 17h1"/><path d="M7 17a2 2 0 1 0-4 0a2 2 0 0 0 4 0z"/><path d="M21 17a2 2 0 1 0-4 0a2 2 0 0 0 4 0z"/></svg>
        <span class="pill-label">Accès</span>
      </a>
      <div class="pill-sep"></div>
      <a href="#region" class="pill-item">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 21.7C17.3 17 20 13 20 10a8 8 0 1 0-16 0c0 3 2.7 7 8 11.7z"/><circle cx="12" cy="10" r="3"/></svg>
        <span class="pill-label">Région</span>
      </a>
      <div class="pill-sep"></div>
      <a href="#rsvp" class="pill-item">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
        <span class="pill-label">RSVP</span>
      </a>
      <div class="pill-sep"></div>
      <a href="#contact" class="pill-item">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
        <span class="pill-label">Contact</span>
      </a>
    </div>

    <section class="hero" id="top" data-after-gate>
      <div class="hero-date">11 septembre 2026<br />Crillon-le-Brave</div>
      <h1 class="hero-names" data-audience="locked">
        Magali
        <span class="ampersand">&</span>
        Perceval
      </h1>

      <img class="gate-card" src="./images/carte%20mariage.png" alt="" loading="eager" data-audience="member" />

      <div class="hero-access" data-audience="locked" data-gate>
        <p class="hero-location">Provence, France</p>
        <div class="gate-wrap">
          <form class="gate-form" data-gate-form>
            <div class="gate-row">
              <input class="gate-input" id="code" name="code" type="password" inputmode="text" autocomplete="one-time-code" placeholder="Code d’accès" data-gate-input />
              <button class="gate-button" type="submit">Entrer</button>
            </div>
            <div class="gate-meta">
              <div class="gate-error" role="status" aria-live="polite" data-gate-error></div>
              <a href="#" class="gate-reset" data-gate-reset>Effacer</a>
            </div>
          </form>
        </div>
      </div>

      <p class="hero-location" data-audience="member">Provence, France</p>
      <div class="hero-scroll" data-audience="member"><span></span></div>
    </section>

    <div class="divider" data-audience="member"><div class="divider-line"></div></div>

    <section id="festivites" data-audience="member">
      <div class="reveal">
        <div class="section-label">Programme</div>
        <h2 class="section-title">Les festivités</h2>
        <p class="section-intro">Toutes les informations pour le jeudi, vendredi et samedi.</p>
      </div>

      <div class="event-card reveal" data-audience="young">
        <div class="card-header">
          <span class="card-day">Jeudi — Accueil</span>
          <span class="card-badge">10 septembre 2026</span>
        </div>
        <div class="card-body">
          <p>Nous accueillons ceux qui seront déjà dans la région pour le mariage à partir de 16h dans la maison des parents de Perceval, à Crillon-le-Brave, pour une aprem relax au bord de la piscine, pizza et cocktail.</p>
          <p><strong>Mot d'ordre :</strong> faites au mieux pour vous.</p>
          <div class="ceremony-illus ceremony-illus--large ceremony-illus--center" aria-hidden="true">
            <img src="./images/jeudi%20welcome.png" alt="" loading="lazy" />
          </div>
          <div class="info-grid">
            <span class="info-label">Adresse</span>
            <span class="info-value"><a href="https://www.google.com/maps/search/?api=1&query=219%2C%20Chemin%20de%20la%20Croix%20du%20Coq%2C%2084410%20Crillon-le-Brave" target="_blank" rel="noopener noreferrer">219, Chemin de la Croix du Coq, 84410 Crillon-le-Brave</a></span>
            <span class="info-label">Horaire</span>
            <span class="info-value">16h – 22h</span>
            <span class="info-label">Dress code</span>
            <span class="info-value">Pas de dress code. Maillots + tenue d'été. Birkenstock et sandales encouragées.</span>
          </div>
        </div>
      </div>

      <div class="event-card reveal">
        <div class="card-header">
          <span class="card-day">Vendredi — Jour J</span>
          <span class="card-badge">11 septembre 2026</span>
        </div>
        <div class="card-body">
          <div class="ceremony-head">
            <div class="card-subtitle">Partie 1 — Église</div>
            <div class="ceremony-illus" aria-hidden="true">
              <img src="./images/eglise%20m%26p.png" alt="" loading="lazy" />
            </div>
          </div>
          <div class="info-grid">
            <span class="info-label">Heure</span>
            <span class="info-value">14h30</span>
            <span class="info-label">Adresse</span>
            <span class="info-value"><a href="https://www.google.com/maps/search/?api=1&query=18%2C%20Rue%20Escalado%2C%2084410%20Crillon-le-Brave" target="_blank" rel="noopener noreferrer">18, Rue Escalado, 84410 Crillon-le-Brave</a></span>
            <span class="info-label">Parking</span>
            <span class="info-value">Parking de l'église ou "Rue du Capitaine Crillon"</span>
          </div>

          <div class="ceremony-head">
            <div class="card-subtitle">Partie 2 — Domaine des Pins</div>
            <div class="ceremony-illus" aria-hidden="true">
              <img src="./images/domaine%20de%20pins%20.png" alt="" loading="lazy" />
            </div>
          </div>
          <div class="info-grid">
            <span class="info-label">Réception</span>
            <span class="info-value">16h30</span>
            <span class="info-label">Dîner</span>
            <span class="info-value">19h</span>
            <span class="info-label">Soirée</span>
            <span class="info-value">22h – 3h</span>
            <span class="info-label">Adresse</span>
            <span class="info-value"><a href="https://www.google.com/maps/search/?api=1&query=1100%20Chem.%20Mormoiron%20par%20les%20Mourands%2C%2084410%20Crillon-le-Brave%2C%20France" target="_blank" rel="noopener noreferrer">Domaine des Pins — 1100 Chem. Mormoiron par les Mourands, 84410 Crillon-le-Brave, France</a></span>
            <span class="info-label">Déplacement</span>
            <span class="info-value">Parking à côté du domaine (indiqué à l'arrivée). Marche possible depuis l'église (20–25 min).</span>
            <span class="info-label">Dress code</span>
            <span class="info-value">Tenue de ville</span>
          </div>
        </div>
      </div>

      <div class="event-card reveal" data-audience="young">
        <div class="card-header">
          <span class="card-day">Samedi — Brunch festif</span>
          <span class="card-badge">12 septembre 2026</span>
        </div>
        <div class="card-body">
          <div class="ceremony-head">
            <div class="card-subtitle">Brunch</div>
            <div class="ceremony-illus" aria-hidden="true">
              <img src="./images/brunch.png" alt="" loading="lazy" />
            </div>
          </div>
          <div class="info-grid">
            <span class="info-label">Horaire</span>
            <span class="info-value">13h – 22h</span>
            <span class="info-label">Adresse</span>
            <span class="info-value"><a href="https://www.google.com/maps/search/?api=1&query=1100%20Chem.%20Mormoiron%20par%20les%20Mourands%2C%2084410%20Crillon-le-Brave%2C%20France" target="_blank" rel="noopener noreferrer">Domaine des Pins — 1100 Chem. Mormoiron par les Mourands, 84410 Crillon-le-Brave, France</a></span>
            <span class="info-label">Dress code</span>
            <span class="info-value">À compléter</span>
          </div>
        </div>
      </div>
    </section>

    <div class="divider" data-audience="member"><div class="divider-line"></div></div>

    <section id="transport" data-audience="member">
      <div class="reveal">
        <div class="section-label">Pratique</div>
        <h2 class="section-title">Transport & logement</h2>
        <p class="section-intro">Comment venir, se déplacer, et où dormir autour de Crillon-le-Brave.</p>
      </div>

      <div class="transport-block reveal">
        <h3>Venir à Crillon-le-Brave</h3>

        <div class="transport-method">
          <div class="transport-head">
            <h4>En train</h4>
            <div class="transport-illus" aria-hidden="true">
              <img src="./images/tgv.png" alt="" loading="lazy" />
            </div>
          </div>
          <p>Gare la plus proche : Avignon (≈ 35 minutes en voiture du village).</p>
          <p>Depuis Bruxelles-Midi : 3 trains directs (matin, vers 13h, fin de journée) ≈ 5h. Il existe aussi de nombreux trains avec une escale à Paris, souvent moins chers.</p>
          <p>Attention : certains billets ne sont disponibles qu'à partir de X mois avant le trajet. Mets une alerte et réserve dès que possible.</p>
          <p>Petit conseil : carte réduction à 49€.</p>
        </div>

        <div class="transport-method">
          <div class="transport-head">
            <h4>En voiture</h4>
            <div class="transport-illus" aria-hidden="true">
              <img src="./images/voiture.png" alt="" loading="lazy" />
            </div>
          </div>
          <p>Trajet classique vers le Sud ≈ 9h. Escale conseillée à Beaune si en deux jours. Covoiturage encouragé.</p>
        </div>
      </div>

      <div class="transport-block reveal">
        <h3>Se déplacer</h3>

        <div class="transport-method">
          <h4>Taxi</h4>
          <p>Contacts taxi : à ajouter. On les repartagera avant le mariage pour éviter que quiconque reprenne sa voiture sous alcool.</p>
        </div>

        <div class="transport-method">
          <h4>Voiture de location</h4>
          <p>Louer une voiture depuis la gare d'Avignon peut être pratique.</p>
        </div>

        <div class="transport-method">
          <h4>Vélo / à pied</h4>
          <p>Super option pour profiter de l'ambiance locale.</p>
        </div>
      </div>

      <div class="transport-block reveal">
        <h3>Où dormir ?</h3>
        <div class="lodging-grid">
          <div class="lodging-item"><strong>Crillon-le-Brave</strong><span>Le village où se situe le Domaine des Pins où la journée du vendredi se déroule. Idéal pour dormir sur place ou à quelques minutes à pied/voiture du lieu de mariage ou de l’église. Certains lieux à Crillon sont à distance marchable de tous les lieux où nous vous accueillons.</span></div>
          <div class="lodging-item"><strong>Bedoin</strong><span>Bedoin se situe à 10 minutes en voiture de Crillon-le-Brave. Ville de départ du Mont Ventoux. Le village est beaucoup plus grand que Crillon donc il y a sûrement plus de logements disponibles (et accessibles financièrement).</span></div>
          <div class="lodging-item"><strong>Caromb et Saint-Pierre-de-Vassols</strong><span>Caromb et Saint-Pierre-de-Vassols se situent tous les deux à 12 minutes en voiture de Crillon-le-Brave. Même constat que Bédoin en termes de disponibilité de logements.</span></div>
          <div class="lodging-item"><strong>Modène</strong><span>Modène se situe à 20 minutes en voiture de Crillon-le-Brave.</span></div>
        </div>
      </div>

      <div class="tip-box reveal">
        <p>Si vous avez des questions ou besoin d'aide pour les transports, <a href="#contact">contactez-nous</a>.</p>
      </div>
    </section>

    <div class="divider" data-audience="member"><div class="divider-line"></div></div>

    <section id="region" data-audience="member">
      <div class="reveal">
        <div class="section-label">Explorer</div>
        <h2 class="section-title">À faire dans la région</h2>
        <p class="section-intro">Quelques idées pour profiter du Ventoux et des environs.</p>
      </div>

      <div class="activity-grid reveal">
        <div class="activity-card">
          <div class="activity-head">
            <h4>Mont Ventoux</h4>
            <div class="activity-illus" aria-hidden="true">
              <img src="./images/mont%20ventoux%20bb.png" alt="" loading="lazy" />
            </div>
          </div>
          <p>Le coup de cœur de la région : le Mont Ventoux. Vous pouvez le grimper à pieds (via la montagne — voir carte pour les différents itinéraires), ou en profiter pour le monter à vélo. Bédoin est le village phare et le plus proche des départs à vélo.</p>
          <ul>
            <li><strong>Adresse de location de vélo conseillée :</strong> à venir. (Réservez votre vélo en avance, vous verrez que vous ne serez pas seuls.)</li>
            <li><strong>Café/restaurant/bar pour bien terminer l’ascension :</strong> à venir. Sinon le village est rempli de petits cafés locaux.</li>
            <li><strong>Le Belvédère (restaurant) :</strong> 270 Route de Bédoin, Lieu-dit, Chem. de Malaucène, 84410 Crillon-le-Brave</li>
          </ul>
        </div>
        <div class="activity-card">
          <div class="activity-head">
            <h4>Balades &amp; villages</h4>
            <div class="activity-illus" aria-hidden="true">
              <img src="./images/velo.png" alt="" loading="lazy" />
            </div>
          </div>
          <p>Balades autour du village (voir carte). Crillon-Le-Brave est entouré de magnifiques petits villages, certains proches et d’autres un peu plus éloignés.</p>
          <ul>
            <li><strong>Villages connus :</strong> Gordes</li>
            <li><strong>Nos conseils :</strong> Suzette, Le Baroux</li>
          </ul>
        </div>
        <div class="activity-card">
          <div class="activity-head">
            <h4>Dégustation de vin</h4>
            <div class="activity-illus" aria-hidden="true">
              <img src="./images/vignes.png" alt="" loading="lazy" />
            </div>
          </div>
          <p>La région du Ventoux abrite de nombreux vignobles. Il vaut toujours mieux appeler pour réserver.</p>
          <ul>
            <li><strong>La Ferme Saint Pierre</strong></li>
            <li><strong>Valcombe</strong></li>
          </ul>
        </div>
        <div class="activity-card">
          <div class="activity-head">
            <h4>Manger / marchés</h4>
            <div class="activity-illus" aria-hidden="true">
              <img src="./images/panier%20legumes.png" alt="" loading="lazy" />
            </div>
          </div>
          <p>Attention : veillez à réserver les restaurants un peu à l’avance.</p>
          <ul>
            <li><strong>Restaurants :</strong> <a href="http://www.lesaintromain.fr/" target="_blank" rel="noopener">Le Saint Romain</a> (Crillon-le-Brave — brasserie simple et plus abordable, dans le centre du village), <a href="http://www.clovisetbasina.com/" target="_blank" rel="noopener">Clovis et Basina</a> (Crillon-Le-Brave — vue incroyable et menu délicieux), <a href="http://pascal-poulain.com/" target="_blank" rel="noopener">Le Six à table</a> (Caromb), <a href="https://lacarte.menu/restaurants/bedoin/lily-et-paul" target="_blank" rel="noopener">Lily et Paul</a> (Bédoin)</li>
            <li><strong>Boire un verre :</strong> <a href="https://www.crillonlebrave.com/" target="_blank" rel="noopener">Hôtel Crillon le Brave</a> (prix à la hauteur, mais très bel hôtel de charme — possibilité de manger ou simplement boire un verre, avec spa)</li>
            <li><strong>Marchés (nos préférés) :</strong> Bédoin (lundi matin), Pernes (village des artistes — samedi matin), Isle-sur-la-Sorgue (dimanche matin)</li>
            <li><strong>Courses :</strong> magasins de fruits et légumes à Carpentras, boulangerie Le Fournil de Crillon, U-Express Saint-Pierre-de Vassols</li>
          </ul>
        </div>
      </div>
    </section>

    <div class="divider" data-audience="member"><div class="divider-line"></div></div>

    <section id="rsvp" data-audience="member">
      <div class="reveal">
        <div class="section-label">Confirmer</div>
        <h2 class="section-title">RSVP</h2>
        <p class="section-intro">Merci de confirmer votre présence avant le 1er juin 2026.</p>
      </div>

      <div class="rsvp-card reveal">
        <form id="rsvp-form" onsubmit="handleRSVP(event)">
          <div class="form-row">
            <div class="form-group">
              <label for="prenom">Prénom</label>
              <input type="text" id="prenom" name="prenom" required placeholder="Votre prénom" />
            </div>
            <div class="form-group">
              <label for="nom">Nom</label>
              <input type="text" id="nom" name="nom" required placeholder="Votre nom" />
            </div>
          </div>

          <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" required placeholder="votre@email.com" />
          </div>

          <div class="form-group">
            <label class="label-block">Serez-vous présent(e) ?</label>
            <div class="radio-group">
              <label class="radio-card">
                <input type="radio" name="presence" value="oui" required />
                <span class="radio-label">
                  <span class="radio-icon">✓</span>
                  Avec joie
                </span>
              </label>
              <label class="radio-card">
                <input type="radio" name="presence" value="non" />
                <span class="radio-label">
                  <span class="radio-icon">✕</span>
                  Malheureusement non
                </span>
              </label>
            </div>
          </div>

          <div class="form-group" id="events-group" data-audience="young" style="display:none;">
            <label class="label-block">À quels moments serez-vous présent(e) ?</label>
            <div class="checkbox-group">
              <label class="checkbox-card">
                <input type="checkbox" name="events" value="jeudi" />
                <span class="checkbox-label">
                  <span class="checkbox-day">Jeudi</span>
                  <span class="checkbox-desc">Accueil piscine & pizza</span>
                </span>
              </label>
              <label class="checkbox-card">
                <input type="checkbox" name="events" value="vendredi" checked disabled />
                <span class="checkbox-label">
                  <span class="checkbox-day">Vendredi</span>
                  <span class="checkbox-desc">Cérémonie & soirée</span>
                </span>
              </label>
              <label class="checkbox-card">
                <input type="checkbox" name="events" value="samedi" />
                <span class="checkbox-label">
                  <span class="checkbox-day">Samedi</span>
                  <span class="checkbox-desc">Brunch festif</span>
                </span>
              </label>
            </div>
          </div>

          <div class="form-group" id="allergies-group" style="display:none;">
            <label for="allergies">Allergies ou régime alimentaire</label>
            <input type="text" id="allergies" name="allergies" placeholder="Végétarien, sans gluten, etc." />
          </div>

          <div class="form-group">
            <label for="message">Un petit mot ? <span class="label-optional">(optionnel)</span></label>
            <textarea id="message" name="message" rows="3" placeholder="On a hâte de vous lire..."></textarea>
          </div>

          <button type="submit" class="btn-submit" id="btn-submit">
            <span class="btn-text">Envoyer ma réponse</span>
            <span class="btn-loader" style="display:none;">
              <span class="dot"></span><span class="dot"></span><span class="dot"></span>
            </span>
          </button>
        </form>

        <div id="rsvp-success" style="display:none;">
          <div class="success-icon">♥</div>
          <h3 class="success-title">Merci !</h3>
          <p class="success-text">Votre réponse a bien été enregistrée.<br />On a hâte de vous retrouver en Provence.</p>
        </div>
      </div>
    </section>

    <!-- FOOTER -->
    <footer id="contact" data-audience="all">
      <div class="footer-ornament">
        <span></span>
        <div class="diamond"></div>
        <span></span>
      </div>
      <p class="footer-heading">Contact</p>
      <div class="footer-contacts">
        <a href="tel:+32479947943">Magali : +32 479 94 79 43</a>
        <a href="tel:+32490649129">Perceval : +32 490 64 91 29</a>
        <span class="footer-break" aria-hidden="true"></span>
        <a href="mailto:crillon.septembre@gmail.com">crillon.septembre@gmail.com</a>
        <span>Domicile : Rue Wéry 25 1050 Ixelles</span>
      </div>
      <p class="footer-credit">Designed by <a href="https://marcodb.be" target="_blank" rel="noopener">marcodb</a></p>
      <a href="#" id="cadeau" class="footer-gift">Liste cadeau</a>
      <p class="footer-switch" data-audience="member"><a href="#" data-clear-access>Changer de code</a></p>
    </footer>

    <script>
      if (window.MPAccess) {
        window.MPAccess.mountGate();
        window.MPAccess.mountSwitchLinks();
        window.MPAccess.applyAudience();
      }

      const SHEET_URL = 'https://script.google.com/macros/s/AKfycbzqt5-3kdk-SQjFFr6bhQQXFquAEBRfIavgwFezpeQnQ8T_HgJAHj9neNtO-oIx9a_HTg/exec';

      var USER_TYPE = (function () {
        try {
          var fromBody = (document.body.dataset.userType || '').toLowerCase();
          if (fromBody) return fromBody;
          var role = window.localStorage.getItem('mp_access_role');
          return role === 'young' ? 'jeune' : 'invite';
        } catch (e) {
          return 'invite';
        }
      })();

      // ═══ SCROLL REVEAL ═══
      const reveals = document.querySelectorAll('.reveal');
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add('visible');
            }
          });
        },
        { threshold: 0.12 }
      );
      reveals.forEach((el) => observer.observe(el));

      // ═══ NAV SCROLL ═══
      const nav = document.getElementById('main-nav');
      if (nav) {
        window.addEventListener('scroll', () => {
          nav.classList.toggle('scrolled', window.scrollY > 60);
        });
      }

      // ═══ SCROLL SPY ═══
      const allSections = document.querySelectorAll('section[id], footer[id]');
      const desktopLinks = document.querySelectorAll('.nav-links a[href^="#"]');
      const pillLinks = document.querySelectorAll('.pill-item[href^="#"]');

      function updateActive() {
        let current = '';
        allSections.forEach((section) => {
          const top = section.offsetTop - 140;
          if (window.scrollY >= top) {
            current = section.getAttribute('id');
          }
        });
        desktopLinks.forEach((link) => {
          link.classList.toggle('active', link.getAttribute('href') === '#' + current);
        });
        pillLinks.forEach((link) => {
          link.classList.toggle('active', link.getAttribute('href') === '#' + current);
        });
      }

      window.addEventListener('scroll', updateActive);
      updateActive();

      // ─── RSVP FORM LOGIC ───
      const presenceRadios = document.querySelectorAll('input[name="presence"]');
      const eventsGroup = document.getElementById('events-group');
      const allergiesGroup = document.getElementById('allergies-group');

      function setGroupDisplay(el, shouldShow) {
        if (!el) return;

        const isHiddenByAudience = !!el.hidden;
        const finalShow = isHiddenByAudience ? false : shouldShow;

        if (!isHiddenByAudience) {
          el.style.display = finalShow ? 'block' : 'none';
        }

        el.querySelectorAll('input, select, textarea, button').forEach((node) => {
          if (node.closest('.stepper')) return;
          node.disabled = !finalShow;
        });
      }

      function enforceFridayLock(isComing) {
        const vendrediCb = document.querySelector('input[name="events"][value="vendredi"]');
        if (!vendrediCb) return;

        if (!vendrediCb.dataset.locked) {
          vendrediCb.addEventListener('change', () => {
            if (!vendrediCb.checked) vendrediCb.checked = true;
          });
          vendrediCb.dataset.locked = '1';
        }

        if (isComing) {
          vendrediCb.checked = true;
          vendrediCb.disabled = true;
        } else {
          vendrediCb.disabled = false;
          vendrediCb.checked = false;
        }
      }

      presenceRadios.forEach((radio) => {
        radio.addEventListener('change', () => {
          const coming = radio.value === 'oui';
          setGroupDisplay(allergiesGroup, coming);

          setGroupDisplay(eventsGroup, coming && USER_TYPE === 'jeune');
          enforceFridayLock(coming && USER_TYPE === 'jeune');
        });
      });

      function handleRSVP(e) {
        e.preventDefault();
        var btn = document.getElementById('btn-submit');
        var btnText = btn.querySelector('.btn-text');
        var btnLoader = btn.querySelector('.btn-loader');

        btnText.style.display = 'none';
        btnLoader.style.display = 'inline-flex';
        btn.disabled = true;

        var form = document.getElementById('rsvp-form');
        var coming = form.querySelector('input[name="presence"]:checked');
        var isComing = coming && coming.value === 'oui';

        var jeudiEl = form.querySelector('input[name="events"][value="jeudi"]');
        var samediEl = form.querySelector('input[name="events"][value="samedi"]');

        var jeudi = 'Non';
        var vendredi = isComing ? 'Oui' : 'Non';
        var samedi = 'Non';

        if (isComing) {
          if (jeudiEl) jeudi = jeudiEl.checked ? 'Oui' : 'Non';
          if (samediEl) samedi = samediEl.checked ? 'Oui' : 'Non';
        }

        var allergiesInput = document.getElementById('allergies');
        var allergiesVal = allergiesInput ? allergiesInput.value || 'Aucune' : 'Aucune';

        var messageInput = document.getElementById('message');
        var messageVal = messageInput ? messageInput.value : '';

        var payload = {
          prenom: form.prenom.value,
          nom: form.nom.value,
          email: form.email.value,
          presence: isComing ? 'Oui' : 'Non',
          nb_personnes: isComing ? '1' : '0',
          accompagnants: 'Aucun',
          jeudi: jeudi,
          vendredi: vendredi,
          samedi: samedi,
          allergies: isComing ? allergiesVal : '',
          message: messageVal
        };

        fetch(SHEET_URL, {
          method: 'POST',
          mode: 'no-cors',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        }).then(function() {
          form.style.display = 'none';
          document.getElementById('rsvp-success').style.display = 'block';
        }).catch(function() {
          btnText.textContent = 'Erreur, réessayer';
          btnText.style.display = 'inline';
          btnLoader.style.display = 'none';
          btn.disabled = false;
        });
      }

      window.handleRSVP = handleRSVP;

      const selectedPresence = document.querySelector('input[name="presence"]:checked');
      const coming = selectedPresence ? selectedPresence.value === 'oui' : false;
      setGroupDisplay(allergiesGroup, coming);

      setGroupDisplay(eventsGroup, coming && USER_TYPE === 'jeune');
      enforceFridayLock(coming && USER_TYPE === 'jeune');
    </script>
  </body>
</html>
